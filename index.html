<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Sanctuary: Content Hub</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f3ff; /* Very Light Violet/Lavender Background */
        }
        .gradient-bg {
            background: linear-gradient(135deg, #6b46c1 0%, #a78bfa 100%); /* Purple to Lavender Gradient */
        }
        .btn-link {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="min-h-screen antialiased">

    <!-- Header Section -->
    <header class="gradient-bg py-10 shadow-lg">
        <div class="max-w-xl mx-auto px-4 text-center">
            <h1 class="text-4xl font-bold text-white mb-2">The Sanctuary</h1>
            <p class="text-indigo-200 text-lg">Mindfulness, Exploration, and Self-Reflection</p>
        </div>
    </header>

    <main class="max-w-xl mx-auto p-4 md:p-6">

        <!-- Section 1: Core Platform Links -->
        <section class="mb-10">
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                
                <!-- Blog Link -->
                <a href="#blog-link-placeholder" class="btn-link bg-white text-gray-700 p-3 rounded-lg text-center font-semibold border border-indigo-200 hover:bg-indigo-50">
                    <svg class="w-5 h-5 inline-block mr-1 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.208 5 7.5 5A3.5 3.5 0 004 8.5c0 1.25.19 2.457.5 3.5m0 0l-1.5 1.5m1.5-1.5a4.866 4.866 0 01-1.455 1.833M16.5 5a3.5 3.5 0 110 7 3.5 3.5 0 010-7zm-9 11a3.5 3.5 0 110-7 3.5 3.5 0 010 7z"></path></svg>
                    Blog
                </a>

                <!-- Videos Link (YouTube) -->
                <a href="https://www.youtube.com/playlist?list=PLPA2J3pvHbj6XSZ9HzSjYVB0xtjnxETdv" class="btn-link bg-white text-gray-700 p-3 rounded-lg text-center font-semibold border border-indigo-200 hover:bg-indigo-50">
                    <svg class="w-5 h-5 inline-block mr-1 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.55 2.275A.5.5 0 0119.5 13v-2a.5.5 0 01-.45-.275L15 10zm-3-3v2.5M12 12v3M9 7v2.5M9 12v3m6-5.5v2.5m-3 3v2.5M15 12v3m0-5.5v2.5M9 12v3m0-5.5v2.5M12 12v3"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.55 2.275A.5.5 0 0119.5 13v-2a.5.5 0 01-.45-.275L15 10zM5.25 10.5v3.0"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2z"></path></svg>
                    Videos
                </a>
                
                <!-- Playlists Link (Spotify) -->
                <a href="https://open.spotify.com/playlist/3eNqGBuC1oKbhlYlvRzKh5?si=W7bU59s7RZOdLLdeiscI_g&pi=vXHck6d3TX6Ar" class="btn-link bg-white text-gray-700 p-3 rounded-lg text-center font-semibold border border-indigo-200 hover:bg-indigo-50">
                    <svg class="w-5 h-5 inline-block mr-1 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17l4.243-4.243a4 4 0 10-5.657-5.657 4 4 0 005.657 5.657z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.243 14.243L19 19"></path></svg>
                    Playlists
                </a>

                <!-- Contact Link -->
                <a href="mailto:your_email@example.com" class="btn-link bg-indigo-500 text-white p-3 rounded-lg text-center font-semibold border border-indigo-700 hover:bg-indigo-600 col-span-2 sm:col-span-1">
                    <svg class="w-5 h-5 inline-block mr-1 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.848 5.232a2 2 0 002.304 0L21 8m-1 8h2M3 8v8a2 2 0 002 2h14a2 2 0 002-2V8M3 8L21 8"></path></svg>
                    Contact Me
                </a>

                <!-- Meditation Monitor App Link -->
                <a href="https://godzillaborland-arch.github.io/meditation-stages-monitor-app/" class="btn-link bg-cyan-500 text-white p-3 rounded-lg text-center font-semibold border border-cyan-700 hover:bg-cyan-600 col-span-2 sm:col-span-1">
                    <svg class="w-5 h-5 inline-block mr-1 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L12 19.25L14.25 17M12 4V19.25"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 10h10M4 14h16"></path></svg>
                    Meditation App
                </a>
            </div>
        </section>

        <!-- Section 2: Latest Content by Theme -->
        <section class="mb-10">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Latest Content by Theme</h2>

            <div class="space-y-6">

                <!-- Spiritual Focus Card -->
                <div class="bg-white p-5 rounded-xl card-shadow border border-purple-100">
                    <h3 class="text-xl font-semibold text-purple-700 mb-3 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-cyan-500" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"></path></svg>
                        Spiritual Focus
                    </h3>
                    <ul class="space-y-3">
                        <li class="border-b pb-2">
                            <a href="https://quantumviewpoint.blogspot.com/2025/10/tesla-dhyana-analogy-fulfilled.html" class="block hover:text-cyan-500 transition duration-200">
                                <p class="font-medium">Blog: Tesla Dhyana Analogy Fulfilled</p>
                                <span class="text-xs text-gray-500">Topic: Consciousness & Physics</span>
                            </a>
                        </li>
                        <li class="border-b pb-2">
                            <a href="https://medium.com/@sundar2rajan/building-the-meditation-states-monitor-from-inner-yardstick-to-interactive-app-adca28e41481" class="block hover:text-cyan-500 transition duration-200">
                                <p class="font-medium">Medium: Building the Meditation States Monitor (Read)</p>
                                <span class="text-xs text-gray-500">Topic: App Development & Theory</span>
                            </a>
                        </li>
                        <li class="pb-2">
                            <a href="https://open.spotify.com/playlist/3eNqGBuC1oKbhlYlvRzKh5?si=W7bU59s7RZOdLLdeiscI_g&pi=vXHck6d3TX6Ar" class="block hover:text-cyan-500 transition duration-200">
                                <p class="font-medium">Spotify: Alpha Wave Sleep Playlist (Listen Now)</p>
                                <span class="text-xs text-gray-500">Playlist: Deep Rest</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Travel Focus Card -->
                <div class="bg-white p-5 rounded-xl card-shadow border border-purple-100">
                    <h3 class="text-xl font-semibold text-purple-700 mb-3 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-cyan-500" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>
                        Travel & Exploration
                    </h3>
                    <ul class="space-y-3">
                        <li class="border-b pb-2">
                            <a href="https://youtu.be/KBFemHH5feU?si=fd6eX6OLWAbAA9oX" class="block hover:text-cyan-500 transition duration-200">
                                <p class="font-medium">YouTube: Kauai — Sunrises & Nā Pali Cruise (Vlog)</p>
                                <span class="text-xs text-gray-500">Destination: Southeast Asia</span>
                            </a>
                        </li>
                        <li class="pb-2">
                            <a href="#" class="block hover:text-cyan-500 transition duration-200">
                                <p class="font-medium">Blog: Solo Hiking the Dolomites (Photo Essay)</p>
                                <span class="text-xs text-gray-500">Topic: Mountain Adventures</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Personal Focus Card -->
                <div class="bg-white p-5 rounded-xl card-shadow border border-purple-100">
                    <h3 class="text-xl font-semibold text-purple-700 mb-3 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-cyan-500" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-2h-2v2zm0-4h2V7h-2v6z"></path></svg>
                        Personal & Projects
                    </h3>
                    <ul class="space-y-3">
                        <li class="border-b pb-2">
                            <a href="#" class="block hover:text-cyan-500 transition duration-200">
                                <p class="font-medium">Project: My 30-Day Digital Detox Challenge</p>
                                <span class="text-xs text-gray-500">Topic: Well-being & Habits</span>
                            </a>
                        </li>
                        <li class="pb-2">
                            <a href="#" class="block hover:text-cyan-500 transition duration-200">
                                <p class="font-medium">Playlist: Focus Music for Deep Work</p>
                                <span class="text-xs text-gray-500">Spotify: Productivity Mix</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 3: Featured Project Showcase (Meditation Monitor App) -->
        <section class="mb-10 p-5 bg-indigo-50 rounded-xl card-shadow">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b border-indigo-200 pb-2 flex items-center">
                <svg class="w-6 h-6 mr-2 text-indigo-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0h6"></path></svg>
                Featured Project: Meditation Monitor
            </h2>
            <p class="text-gray-600 mb-4">Interact with the meditation states monitor app below. This is an embedded web application.</p>
            
            <div class="relative w-full overflow-hidden rounded-lg border-2 border-indigo-300" style="padding-top: 56.25%; /* 16:9 Aspect Ratio */">
                <iframe id="app-embed" 
                        src="https://godzillaborland-arch.github.io/meditation-stages-monitor-app/" 
                        class="absolute top-0 left-0 w-full h-full" 
                        title="Meditation Stages Monitor App" 
                        frameborder="0" 
                        allowfullscreen>
                </iframe>
            </div>
        </section>


        <!-- Section 4: Contribute Your Wisdom (Firestore Data Collection) -->
        <section class="mb-10 p-5 bg-white rounded-xl card-shadow border border-cyan-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b border-cyan-300 pb-2 flex items-center">
                <svg class="w-6 h-6 mr-2 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5M17 4h5M5 4h5M5 20h5M13 14h-2m-4-4V7a4 4 0 014-4h2a4 4 0 014 4v3m-8 4h8a4 4 0 004-4v-1a4 4 0 00-4-4h-8a4 4 0 00-4 4v1a4 4 0 004 4z"></path></svg>
                Contribute Your Wisdom
            </h2>
            <p class="text-gray-600 mb-4">What is your measure for successful meditation?</p>
            
            <input type="text" id="meditation-measure" placeholder="My measure is..." class="w-full p-3 mb-3 border border-gray-300 rounded-lg focus:ring-cyan-500 focus:border-cyan-500">
            <button id="share-wisdom-button" class="w-full bg-cyan-500 text-white p-3 rounded-lg font-semibold hover:bg-cyan-600 transition duration-200">
                Share My Wisdom
            </button>
            <p id="wisdom-message" class="text-sm mt-2 text-gray-500"></p>

            <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3 border-t pt-3">Collective Wisdom Wall</h3>
            <div id="wisdom-wall" class="space-y-3">
                <!-- Wisdom responses loaded here by JavaScript -->
                <p class="text-gray-500 text-sm">Loading submissions...</p>
            </div>
        </section>

        <!-- Section 5: Ask The Sanctuary (Gemini API) -->
        <section class="p-5 bg-indigo-50 rounded-xl card-shadow border border-indigo-200">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b border-indigo-300 pb-2 flex items-center">
                <svg class="w-6 h-6 mr-2 text-indigo-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17l4.243-4.243a4 4 0 10-5.657-5.657 4 4 0 005.657 5.657z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.243 14.243L19 19"></path></svg>
                Ask The Sanctuary
            </h2>
            <p class="text-gray-600 mb-4">Tap below for a grounded, concise answer on the measure of good meditation.</p>
            
            <button id="ask-button" class="w-full bg-indigo-700 text-white p-3 rounded-lg font-semibold hover:bg-indigo-800 transition duration-200">
                What is the Measure for Good Meditation?
            </button>
            
            <div id="gemini-output" class="mt-4 p-4 bg-white rounded-lg border border-indigo-100 min-h-[50px]">
                <p class="text-gray-500">Tap the button above to receive the answer.</p>
            </div>
        </section>

    </main>

    <!-- FIREBASE DEPENDENCIES -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <!-- CUSTOM JAVASCRIPT LOGIC -->
    <script>
        // Configuration and initialization variables are expected to be available globally
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;

        // --- 1. FIREBASE SETUP (For "Contribute Your Wisdom") ---

        const initFirebase = async () => {
            try {
                // Check if Firebase is already initialized
                if (firebase.apps.length === 0) {
                    const app = firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.firestore();
                auth = firebase.auth();
                
                firebase.firestore.setLogLevel('debug'); // Enable logging for debugging

                // Sign in anonymously or with custom token
                if (initialAuthToken) {
                    await auth.signInWithCustomToken(initialAuthToken);
                } else {
                    await auth.signInAnonymously();
                }
                
                const userId = auth.currentUser ? auth.currentUser.uid : 'anonymous-user';
                console.log(`Firebase authenticated. User ID: ${userId}`);

                // Start listening for responses immediately after authentication
                loadResponses(userId);
            } catch (error) {
                console.error("Error initializing Firebase or authentication:", error);
                const wall = document.getElementById('wisdom-wall');
                if(wall) wall.innerHTML = `<p class="text-red-500">Could not connect to database. Please refresh or try again later.</p>`;
            }
        };

        // --- 2. FIRESTORE DATA HANDLING ---

        const saveResponse = async () => {
            const input = document.getElementById('meditation-measure');
            const measure = input.value.trim();
            const messageElement = document.getElementById('wisdom-message');
            
            if (!db || !auth || !measure) {
                if (!measure) messageElement.textContent = 'Please enter your measure before sharing.';
                else messageElement.textContent = 'Error: Database is not ready.';
                messageElement.classList.remove('text-gray-500');
                messageElement.classList.add('text-red-500');
                return;
            }

            const userId = auth.currentUser ? auth.currentUser.uid : crypto.randomUUID();

            try {
                // Path: /artifacts/{appId}/public/data/meditation_measures
                const collectionPath = `artifacts/${appId}/public/data/meditation_measures`;
                
                await db.collection(collectionPath).add({
                    measure: measure,
                    userId: userId,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                input.value = ''; // Clear input on success
                messageElement.textContent = 'Wisdom shared successfully! Check the wall.';
                messageElement.classList.remove('text-red-500');
                messageElement.classList.add('text-gray-500');

            } catch (e) {
                console.error("Error adding document: ", e);
                messageElement.textContent = `Submission failed: ${e.message}`;
                messageElement.classList.remove('text-gray-500');
                messageElement.classList.add('text-red-500');
            }
        };

        const loadResponses = (currentUserId) => {
            const wall = document.getElementById('wisdom-wall');
            if (!wall) return;
            wall.innerHTML = '<p class="text-gray-500">Loading collective wisdom...</p>';

            try {
                const collectionPath = `artifacts/${appId}/public/data/meditation_measures`;
                const q = db.collection(collectionPath).limit(100); // Limit responses for display
                
                // Listen for real-time updates
                q.onSnapshot((snapshot) => {
                    const responses = [];
                    snapshot.forEach((doc) => {
                        responses.push(doc.data());
                    });

                    // Sort responses by timestamp (newest first, since we can't use orderBy in the query)
                    responses.sort((a, b) => {
                        const timeA = a.timestamp?.toMillis() || 0;
                        const timeB = b.timestamp?.toMillis() || 0;
                        return timeB - timeA;
                    });
                    
                    if (responses.length === 0) {
                        wall.innerHTML = '<p class="text-gray-500">Be the first to share your wisdom!</p>';
                        return;
                    }

                    wall.innerHTML = responses.map(data => {
                        // Display the full user ID for multi-user apps (as per guidelines)
                        const isYou = data.userId === currentUserId ? ' (You)' : '';
                        const date = data.timestamp ? new Date(data.timestamp.toMillis()).toLocaleTimeString() : '...';
                        return `
                            <div class="p-3 bg-indigo-50 border-l-4 border-cyan-500 rounded-md">
                                <p class="text-gray-700">${data.measure}</p>
                                <p class="text-xs text-gray-500 mt-1">Shared by: ${data.userId.substring(0, 12)}...${isYou} at ${date}</p>
                            </div>
                        `;
                    }).join('');
                }, (error) => {
                    console.error("Error listening to Firestore:", error);
                    wall.innerHTML = `<p class="text-red-500">Error loading data: ${error.message}</p>`;
                });

            } catch (e) {
                console.error("Error setting up snapshot listener:", e);
                wall.innerHTML = `<p class="text-red-500">Failed to initialize data listener.</p>`;
            }
        };

        // --- 3. GEMINI API CALL (For "Ask The Sanctuary") ---

        const getGeminiResponse = async () => {
            const button = document.getElementById('ask-button');
            const outputDiv = document.getElementById('gemini-output');
            const originalText = button.textContent;

            if (button.disabled) return;
            
            button.disabled = true;
            button.textContent = 'Seeking Wisdom...';
            outputDiv.innerHTML = '<p class="text-gray-500">Processing the query...</p>';

            const userQuery = "What is a good measure for successful meditation, covering spiritual and neurological aspects?";
            const systemPrompt = "Act as a compassionate and knowledgeable spiritual guide and neuroscience enthusiast. Provide a concise, single-paragraph answer that synthesizes both subjective (spiritual) and objective (neurological) measures of effective meditation.";
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            for (let attempt = 0; attempt < 3; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (text) {
                        outputDiv.innerHTML = `<p class="text-gray-700 font-medium leading-relaxed">${text}</p>`;
                        break; // Success, exit loop
                    } else {
                        throw new Error("API response text was empty.");
                    }

                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error);
                    if (attempt === 2) { // Last attempt failed
                        outputDiv.innerHTML = '<p class="text-red-500">Sorry, the Sanctuary is currently unreachable. Please try again later.</p>';
                    }
                    await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
                }
            }
            
            button.textContent = originalText;
            button.disabled = false;
        };

        // --- 4. INITIALIZATION ---

        const setupListeners = () => {
            document.getElementById('share-wisdom-button')?.addEventListener('click', saveResponse);
            document.getElementById('ask-button')?.addEventListener('click', getGeminiResponse);
        };

        // Start the entire process after the window loads
        window.onload = function() {
            setupListeners();
            initFirebase();
        };

    </script>
</body>
</html>

